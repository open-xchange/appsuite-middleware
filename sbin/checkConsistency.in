#!/bin/bash

OXFUNCTIONS=@oxfunctions@
OXCONFIG=@oxscriptconf@
OXPREFIX=@prefix@
CONSOLELOG=@consolelogfile@

test -f $OXFUNCTIONS || {
	echo "missing common shell functions file"
	exit 1
}

. $OXFUNCTIONS

test -f $OXCONFIG && . $OXCONFIG

ox_set_JAVA_BIN

test -z "$JAVA_XTRAOPTS" && JAVA_XTRAOPTS="-Xms20M -Xmx280M"

JAVA_OPTS="${JAVA_XTRAOPTS} \
-Djava.awt.headless=true \
-Dopenexchange.propfile=$SYSTEMPROPERTIES \
-Djava.util.logging.config.file=$LOGGINGPROPERTIES"

ALLCLASSES=$(for jar in @libdirpath@/*.jar; do
    echo -n "${jar}:"
    done)

if [ -d @oxgroupwaresysconfdir@/log4j ]; then
    ALLCLASSES="${ALLCLASSES}@oxgroupwaresysconfdir@/log4j:"
fi

CLASSPATH="-classpath $ALLCLASSES"

pushd $OXPREFIX

umask 066
exec $JAVA_BIN $JAVA_OPTS $CLASSPATH Consistency > $CONSOLELOG 2>&1

